# Домашнее задание к занятию "Программирование на языке ST: Часть 2"

### Цель задания

Выполнив домашнее задание, вы получите опыт создания программ на языке SCL в программном проекте в TIA Portal 13.

В результате выполнения этого задания вы сможете:

1. Вносить изменения в программный код на языке SCL в соответствии с заданием.
2. Получить опыт работы с системой TIA Portal (в части программирования на языке SCL) и программой PLCSIM в части разработки, загрузки и отладки программ.

------

### Чеклист готовности к домашнему заданию

1. Зарегистрируйтесь на портале Siemens и получите персональный логин и пароль для входа в систему. Процесс регистрации описан в соответствующей инструкции.

2. Загрузите и установите программное обеспечение для создания проекта, входящее в состав пакета TIA Portal с официального ресурса Siemens:

- скачайте все файлы STEP 7 Professional V13 SP2 (DVD 1, DVD 2, SHA-256 checksum) по ссылке в отдельную папку
- запустите SIMATIC_STEP_7_Professional_V13_SP2_Upd4.exe
- пройдите стандартную процедуру установки.

3. Загрузите и установите программное обеспечение для симуляции ПЛК, входящее в состав пакета PLCSIM с официального ресурса Siemens:

- скачайте все файлы STEP 7 PLCSIM V13 SP2 (SIMATIC STEP 7 PLCSIM V13 SP2 for STEP 7 Basic and STEP 7 Professional, SHA-256 checksum) по ссылке в отдельную папку
- запустите SIMATIC_S7_PLCSIM_V13_SP2.exe
- пройдите стандартную процедуру установки.
4. Скачайте по указанной ссылке архив программного проекта Lecture_8_3 и распакуйте его, используя функцию Retrieve среды программирования TIA Portal.
ОБРАТИТЕ ВНИМАНИЕ! Устанавливаются демо-версии программ. Её функционал будет ограничен спустя 21 день после установки. Рекомендуется установка софта на виртуальной машине. Как это сделать, описано в инструкции.

------

### Инструкция к заданию

1. Сделайте копию Шаблона для домашнего задания себе на Google Диск.
2. В названии файла введите корректное название лекции и вашу фамилию и имя.
3. Зайдите в «Настройки доступа» и выберите доступ «Просматривать могут все в Интернете, у кого есть ссылка». Ссылка на инструкцию Как предоставить доступ к файлам и папкам на Google Диске
4. Скопируйте текст задания в свой документ.
5. Выполните домашнее задание, запишите ответы и приложите необходимые скриншоты в свой Google Doc.
6. Для проверки домашнего задания преподавателем отправьте ссылку на ваш документ в личном кабинете.
7. Любые вопросы по решению задач задавайте в чате учебной группы.

------

### Инструменты/ дополнительные материалы, которые пригодятся для выполнения задания

1. TIA Portal 13, PLCSIM 13
2. [Архив проекта Lecture_8_3]()
3. Инструкция по созданию виртуальной машины
4. Шаблон для домашнего задания

------

### Задание 1

В проекте Lecture_8_3 проделать описанные далее операции.

Добавить в программный проект новый блок данных Init_DB.
Организовать в нем массив значений InitValue, содержащий 20 элементов типа Int. Заполнить значения всех элементов вновь созданного массива случайными числами.

Изменить программный код в организационном блоке Startup (OB 100) таким образом, чтобы в каждый элемент массива DefaultValue записывалось значение элемента массива InitValue с тем же номером.

Произвести компиляцию проекта и его загрузку в PLCSIM.
Перевести PLCSIM в режим STOP, а затем - вновь в режим RUN.

В блоке данных DefaultVal_DB включить режим мониторинга и убедиться, что элементы массива DefaultValue содержат значения соответствующих элементов массива InitValue.

Сделать скриншоты OB100, DB DefaultVal_DB и приложить к заданию.

------

### Задание 2

В таблице тегов Default tag table произвести следующие изменения:

- переименовать тег "AI02" в "AnalogValve1_FB_Pos";
- переименовать тег "AO02" в "AnalogValve1_Cmd";
- добавить новый тег "Valve1_FB_Close" (I 0.2);
- добавить новый тег "Valve1_FB_Open" (I 0.3);
- добавить новый тег "Valve1_Cmd" (Q 0.2).

В организационном блоке OB1 (Main) изменить привязки экземпляров функциональных блоков ValveCtrl, AnalogValve_FB, перепривязав входы и выходы к вышеупомянутым тегам.

Произвести компиляцию проекта и его загрузку в PLCSIM.

Изменить значения входа Cmd экземпляра блока ValveCtrl с 0 (FALSE) на 1 (TRUE).
Изменить значения входа CmdIn экземпляра блока AnalogValve_FB с 0 на 50.

В PLCSIM после перехода в режим RUN изменить значения тегов "AnalogValve1_FB_Pos", "Valve1_FB_Close", "Valve1_FB_Open" таким образом, чтобы сбросить признаки ошибок, т.е. чтобы выходы Err экземпляров функциональных блоков имели значение FALSE.

Сделать скриншот OB1 в режиме мониторинга и приложить к заданию.


------

### Задание 3

Изменить функциональный блок FB AnalogValve_FB следующим образом:

- добавить вход MonTime (тип: Time), чтобы задавать время задержки на формирование ошибки с его помощью;
- добавить вход DiffVal (тип: Int), чтобы использовать его для задания допустимого рассогласования между значениями CmdIn и FB_Pos.

Внести соответствующие изменения в блок данных DB_ValveEmul, добавив там поле AnalogValve1_Time (тип: Time, начальное значение: T#60s), AnalogValve1_DiffVal (тип: Int, начальное значение: 15).

Произвести необходимые привязки в экземпляре данного FB, вызываемого в OB1.

Произвести компиляцию проекта и его загрузку в PLCSIM.
В OB1 включить режим мониторинга и убедиться в корректности работы экземпляра FB AnalogValve_FB.

Сделать скриншот работы экземпляра FB с вновь добавленным параметром и приложить его к ДЗ.

------

### Правила приёма работы

- отправлена ссылка на документ (Google Doc) с выполненным заданием в личном кабинете
- документ размещён на личном Google Диске
- к документу настроены права доступа “Просматривать могут все в Интернете, у кого есть ссылка”.

------

### Критерии оценки

1. Задание 1 считается выполненным, если на приложенном скриншоте показаны корректные значения элементов массива DefaultValue.
2. Задание 2 считается выполненным, если на приложенном скриншоте показана корректная работа экземпляров FB со сброшенными признаками ошибок.
3. Задание 3 считается выполненным, если на приложенном скриншоте показана корректная работа экземпляра FB с вновь добавленными параметрами.
